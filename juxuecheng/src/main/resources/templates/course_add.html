<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>课程详情</title>
    <meta name="viewport"
          content="width=720,width=device-width,initial-scale=1,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <link rel="stylesheet" href="/css/myself/mobile.css"/>
    <link rel="stylesheet" href="/css/bootstrap.css"/>
    <link rel="stylesheet" href="/css/jxc-index.css"/>
    <!-- 必须引入的文件-->
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
</head>
<body>
<div class="g-mn" id="weixinshare">
    <div class="row-100">
        <div class="row row-1">
            <div class="row row-1">
                <div class="course-title">
                    <div><h4 class="row-top10" id="courseName" style="color: #ff5500;font-weight:bold"></h4></div>
                    <div class="row-top10">
                        <a href="" class="course-buss" id="bussesserName"></a>
                    </div>
                </div>
            </div>
        </div>
        <div style="background: white;">
            <div class="f-cb row-top-10">
                <HR class="line-1" SIZE=0>
                <div class="row-left">
                    <span class="font-color-red font-size-18-1" id="courseFee" style="margin-right: 50%"></span>
                    <span class="font-color-red font-size-18-1" id="cycleMumber"></span>
                    <span class="font-size-14-1" style="color: #93a1a1">(课时)</span>
                    <HR class="line-1 row-100" color='#987cb9' SIZE=2>
                </div>
                <div class="row-left">
                    <span>开课时间：</span><span class="font-color-1" id="courseBeginTime"></span>
                    <HR class="line-1" color='#987cb9' SIZE=2>
                </div>
                <div class="row-left" style="margin-bottom: 20px;">
                    <span>地址：</span><span class="font-color-1" id="address"></span>
                </div>
            </div>
        </div>
        <div class="row-100 bottom-10"></div>
    </div>

    <div class="m-box" style="margin: 1px;background: white">
        <!-- 师资力量 -->
        <div class="row-100">
            <div class="m-box-hd">
                <div class="tt">授课老师</div>
            </div>
            <div class="row row-11" id="teacherPowerList">
                <div class="row-100 bottom-10"></div>
                <div class='row row-11'>
                    <div style='width: 30%;height: 80px;float: left;'>
                        <img id="teacherImg" class='img-border row-left-10' src='' style='width: 70px;'/>
                    </div>
                    <div style='width: 70%;float: left;line-height: 1.5;'>
                        <div><span class='font-size-16-1 color-1' id="teacherName"></span></div>
                        <div class='intraduce-1'><span class="font-color-1" id="teacherIntroduce"></span></div>
                    </div>
                </div>
                <div style='margin-top: 5px;'></div>
            </div>
        </div>
        <div class="row-100 bottom-10"></div>
    </div>

    <!-- 课程 -->
    <div class="row-1" id="course">
        <div class="m-box">
            <div class="m-box-hd">
                <div class="tt">课程详情</div>
            </div>
            <div class="m-box-mn">
                <div class="row-1">
                    <div class="left-border-1"><span class="font-size-14-1 font-color-1">课程简介</span></div>
                    <div class="row-top10"><span class="font-color-1" id="courseIntraduce"></span>
                    </div>
                </div>
                <div class="row-1 row-top-20">
                    <div class="left-border-1"><span class="font-size-14-1 font-color-1">适用学员</span></div>
                    <div class="row-top10"><span class="font-color-1" id="applyStudent"></span>
                    </div>
                </div>
                <div class="row-1 row-top-20">
                    <div class="left-border-1"><span class="font-size-14-1 font-color-1">课程目标</span></div>
                    <div class="row-top10"><span class="font-color-1" id="courseGoal"></span>
                    </div>
                </div>
                <div class="row-1 row-top-20">
                    <div class="left-border-1"><span class="font-size-14-1 font-color-1">课程内容</span></div>
                    <div class="row-top10"><span class="font-color-1" id="courseContent"></span>
                    </div>
                </div>
                <div class="row-1 row-top-20">
                    <div class="left-border-1"><span class="font-size-14-1 font-color-1">课程特色</span></div>
                    <div class="row-top10"><span class="font-color-1" id="courseSpecial"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--  -->
    <div class="row-1" style="height: 40px;">
    </div>

    <!-- 底部悬浮 -->
    <div class="row-100 ">
        <div class="m-row x-f xuanfu">
            <div class="row-24 float-left" id="wechatConsult" style="background:coral;margin-right: 1px">
                <div>
                    <img class="we-ph" src="../static/h-ui/images/wechat.png"/>
                </div>
                <div>
                    <span class="color-w">微信咨询</span>
                </div>
            </div>
            <div class="row-24 float-left" style="background:coral">
                <a href="tel:" id="callPhone" style="text-decoration:none">
                    <div>
                        <img class="we-ph" src="../static/h-ui/images/phone.png"/>
                    </div>
                    <div>
                        <span class="color-w">电话咨询</span>
                    </div>
                </a>
            </div>
            <div class="row-50 float-left" style="background: red;height: 50px;">
                <div class="b-m" id="registerMorder">报名登记
                </div>
            </div>
        </div>
    </div>

    <!-- 微信弹出框 -->
    <div class="modal fade" id="wechatMorder" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document" style="margin-top: 100px;">
            <div class="modal-content" style="height: 300px;width: 280px;margin-left: 30px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                            style="margin-top: 2px;"><span
                            aria-hidden="true">关闭</span></button>
                    <h4 class="modal-title" id="myModalLabel"></h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <img id="wechatCode" src="" style="width: 200px;height: 200px;margin-left: 20px;"/>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 报名弹出框 -->
    <div class="modal fade" style="margin-top: 50px" id="studentRegister" tabindex="-1" role="dialog"
         aria-labelledby="registerModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="form-group" style="text-align: center">
                        <label>在线报名</label>
                    </div>
                    <div class="form-group" style="text-align: center">
                        <label>提示：报名后老师会主动联系您</label>
                    </div>
                    <div class="form-group">
                        <input type="text" name="txt_departmentlevel" class="form-control" id="name"
                               placeholder="请输入您的姓名">
                    </div>
                    <div class="form-group">
                        <input type="text" name="txt_statu" class="form-control" id="mobile" placeholder="请输入您的手机号码">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span
                            class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
                    </button>
                    <button type="button" id="btn_submit" class="btn btn-primary" data-dismiss="modal"><span
                            class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="../static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="../static/h-ui.admin/js/H-ui.admin.js"></script>
<!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="../lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="../lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../lib/laypage/1.2/laypage.js"></script>
<script src="../jxc/asset/mobile/js/bootstrap.min.js"></script>
<script src="../jxc/asset/mobile/js/mobile.js"></script>
<script>
    /**
     * Created by Administrator on 2018/8/13 0013.
     */
    $(function () {
        var courseId = getUrlParam('courseId');
        courseIndexMsg(courseId);
        wechatShare(courseId)

        // 微信弹出框
        $("#wechatConsult").click(function () {
            $("#myModalLabel").text("添加微信");

            $.ajax({
                url: "/jxcIndex/getWechatCode",
                type: "POST",
                data: {"courseId": courseId},
                success: function (data) {
                    var resultMsg = data['resultMsg'];
                    var wechatCodeName = data['wechatCodeName'];
                    var errorCode = data['errorCode'];
                    if (resultMsg == "1") {
                        $('#wechatMorder').modal();
                        $("#wechatCode").attr('src', 'http://image.yingsuit.com/Logo/' + wechatCodeName);
                    } else {
                        alert(errorCode);
                    }
                }
            })
        })

        // 在线报名
        $("#registerMorder").click(function () {
            $("#registerModalLabel").text("在线报名");
            $('#studentRegister').modal();
        })

        $("#btn_submit").click(function () {
            var name = $("#name").val().trim();
            var mobile = $("#mobile").val().trim();
            if (name == "") {
                alert("请输入姓名！");
                return false;
            }
            if (mobile == "") {
                alert("请输入手机号码！")
                return false;
            }
            // 报名点击提交
            $.ajax({
                url: "/jxcIndex/addStudentRegister",
                type: "POST",
                dataType: "json",
                data: {"name": name, "mobile": mobile, "courseId": courseId},
                success: function (data) {
                    var resultMsg = data['resultMsg'];
                    if (resultMsg == "1") {
                        alert("报名成功,工作人员会主动与您联系！");
                    }
                },
                error: function (data) {
                    alert("网络异常");
                }
            })
        })

    })

    function bussintra_click() {
        $("#course").hide();
        $("#bussesserIntraduction").show();
    }

    function course_click() {
        var bussesserId = getUrlParam('bussesserId');
        $("#bussesserIntraduction").hide();
        $("#course").show();
        getCourseList(bussesserId);
    }

    // 获取url参数
    function getUrlParam(name) {
        //构造一个含有目标参数的正则表达式对象
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        //匹配目标参数
        var r = window.location.search.substr(1).match(reg);
        //返回参数值
        if (r != null) return unescape(r[2]);
        return null;
    }

    function courseIndexMsg(courseId) {
        $.ajax({
            url: "/jxcIndex/getOneCourse",
            type: "POST",
            data: {"courseId": courseId},
            success: function (data) {
                var courseMap = data['courseMap'];
                var CourseImgUrl = "http://image.yingsuit.com/SubjectImg/" + courseMap['subjectImg'];
                var teacherImgUrl = "";
                if (courseMap['teacherLogo'] == null || courseMap['teacherLogo'] == "") {
                    teacherImgUrl = "http://image.yingsuit.com/TeacherImg/defaulTeacher.jpeg";
                } else {
                    teacherImgUrl = "http://image.yingsuit.com/TeacherImg/" + courseMap['teacherLogo'];
                }
                $("title").html(courseMap['courseName'] + courseMap['bussesserName'] + "-聚学城")
                $("#courseImg").attr("src", CourseImgUrl);
                $("#courseName").text(courseMap['courseName']);
                $("#bussesserName").text(courseMap['bussesserName'] + ">>");
                $("#bussesserName").attr('href', 'http://www.juxuecheng.com/jxc/bussesserIndex.html?bussesserId=' + courseMap['id']);
                $("#courseFee").text("¥" + courseMap['courseFee']);
                $("#cycleMumber").text(courseMap['cycleMumber']);
                $("#address").text(courseMap['address']);
                $("#courseBeginTime").text(courseMap['courseBeginTime']);
                $("#teacherImg").attr('src', teacherImgUrl);
                $("#teacherName").text(courseMap['teacherName']);
                $("#teacherIntroduce").text(courseMap['teacherIntroduce']);
                $("#courseIntraduce").text(courseMap['courseIntraduce']);
                $("#applyStudent").text(courseMap['applyStudent']);
                $("#courseGoal").text(courseMap['courseGoal']);
                $("#courseContent").text(courseMap['courseContent']);
                $("#courseSpecial").text(courseMap['courseSpecial']);
                $("#callPhone").attr('href', 'tel:' + courseMap['phone']);
            }
        })
    }

    function wechatShare(courseId) {
        var bussesserName = "";
        var courseName = "";
        var bussImgUrl = "";
        var courseIntraduce = "";
        $.ajax({
            url: "/jxcIndex/getOneCourse",
            type: "POST",
            data: {"courseId": courseId},
            success: function (data) {
                bussesserName = data['courseMap']['bussesserName'];
                courseName = data['courseMap']['courseName'];
                courseIntraduce = data['courseMap']['courseIntraduce'];
                bussImgUrl = "http://image.yingsuit.com/Logo/" + data['courseMap']['uploadLogo'];
            },
        });
        $.ajax({
            url: "/jxcIndex/share",
            type: "POST",
            dataType: "json",
            data: "url=" + window.location.href,
            success: function (data) {
                //配置微信信息
                wx.config({
                    debug: false,    // true:调试时候弹窗
                    appId: data['appId'],  // 微信appid
                    timestamp: data['timestamp'], // 时间戳
                    nonceStr: data.noncestr,  // 随机字符串
                    signature: data['signature'], // 签名
                    jsApiList: ['onMenuShareAppMessage', 'onMenuShareTimeline']
                });
                wx.ready(function () {
                    // 获取“分享给朋友”按钮点击状态及自定义分享内容接口
                    wx.onMenuShareAppMessage({
                        title: '聚学城-' + courseName,
                        desc: courseIntraduce,
                        link: window.location.href,
                        imgUrl: bussImgUrl,
                        type: 'link',
                        success: function () {
                            //成功之后的回调
                        }
                    });
                    wx.onMenuShareTimeline({
                        title: '来自聚学城-' + courseName,
                        link: window.location.href,
                        imgUrl: bussImgUrl,
                        type: 'link',
                        success: function () {
                            //成功之后的回调
                        }
                    });
                });
                wx.error(function (res) {
                    //打印错误消息。及把 debug:false,设置为debug:ture就可以直接在网页上看到弹出的错误提示
                });
            }
        })
    }

</script>
</body>
</html>
